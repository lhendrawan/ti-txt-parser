# Introduction to TI-TXT-Parser #

TI-TXT-Parser is an implementation of simple Python script for parsing TI-TXT file format with some additional features such as memory filling and joining multiple files.

The TI-TXT file format is used as binary representation of MSP430 firmware in the on-chip memory, and usually accepted by common MSP430 software programmer. The TI-TXT file format consists of simple sections which containt the start address and the binary memory content, all represented in hexadecimal format (without 0x prefix). The basic description of TI-TXT file format can be found [here](http://linux.die.net/man/5/srec_ti_txt).

There is a small guide to generate TI-TXT file format on most common MSP430 programming IDE (such as IAR EWB and TI CCSTUDIO) which can be found [here](http://processors.wiki.ti.com/index.php/Generating_and_Loading_MSP430_Binary_Files).

<br>
<br>

<h1>Using the TI-TXT-Parser</h1>

<h2>Basic TI-TXT Translation</h2>

The TI-TXT-Parser script can be used with the followin input parameters:<br>
<br>
<pre>
Usage: TiTxtParser.py [options]<br>
<br>
Options:<br>
-h, --help            show this help message and exit<br>
-f FILE, --file=FILE  parse TI-TXT file with name FILE<br>
-v, --verbose         actiate verbose mode<br>
-s SADDR, --start=SADDR<br>
start address with value of SADDR<br>
-e EADDR, --end=EADDR<br>
end address with value of EADDR<br>
-j JOINFILE, --join=JOINFILE<br>
join main TI-TXT file with second file with name<br>
JOINFILE<br>
-o OUTFILE, --output=OUTFILE<br>
output TI-TXT file with name OUTFILE<br>
</pre>

TI-TXT-Parser parses a TI-TXT file whose name is given with the -f parameter, and generates a simple Python dictionary as the output. Each address of the TI-TXT section will be translated into Python dictionary keys, while the binary content will be translated as the items of the corresponding keys.<br>
<br>
Consider the following simple TI-TXT file with the name input.txt:<br>
<br>
<pre>
@f800<br>
31 40 00 03 B2 40 42 F8<br>
@fffe<br>
00 F8<br>
q<br>
</pre>

If we run the TI-TXT-Parser script for example as follows:<br>
<br>
<pre>
C:\ti-txt-parser\TI-TXT-Parser>python TiTxtParser.py -f input.txt -v<br>
<br>
== Parsing TI-TXT File: input.txt  ==<br>
Opening TI-TXT File:  input.txt<br>
Parsing data starting from address 0xf800 ( 63488 )<br>
Parsing data starting from address 0xfffe ( 65534 )<br>
<br>
== Print out TI-TXT content ==<br>
f800 :  31 40 00 03 b2 40 42 f8<br>
fffe :  00 f8<br>
</pre>

As can be seen above, the output of TI-TXT-Parser is basically a Python dictionary as follows:<br>
<br>
<pre>
{63488: [49, 64, 0, 3, 178, 64, 66, 248], 65534: [0, 248]}<br>
</pre>

The first section of the TI-TXT input file which is:<br>
<br>
<pre>
@f800<br>
31 40 00 03 B2 40 42 F8<br>
</pre>

is translated by the TI-TXT-Parser into the following key-item pair:<br>
<ul><li>key: 63488 (0xF800)<br>
</li><li>items: 49 (0x31), 64 (0x40), 0 (0x00), 3 (0x03), 178 (0xB2), 64 (0x40), 66 (0x42), 248 (0xF8)</li></ul>

while the second section:<br>
<br>
<pre>
@fffe<br>
00 F8<br>
</pre>

is translated by the TI-TXT-Parser into the following key-item pair:<br>
<ul><li>key: 65534 (0xFFFE)<br>
</li><li>items: 0 (0x31), 248 (0xF8)</li></ul>

After the translation step, it is very easy for the user to modify the dictionary content and then print out to a new TI-TXT-Parser output.<br>
<br>
<br>


<h2>TI-TXT-Parser class implementation</h2>

The TI-TXT-Parser is basically implemented as a simple Python class TiTxtParser which can be created by simply executing<br>
<br>
<pre>
>>> ti_txt = TiTxtParser(VERBOSE_MODE)<br>
</pre>

where:<br>
<ul><li>VERBOSE_MODE is either True or False.</li></ul>

After creating the TI-TXT-Parser class object, the following method/function can be used:<br>
<br>
<h3>parse</h3>
parse/translate the given input TI-TXT file into Python dictionary structure as described above.<br>
<br>
<pre>
>>> content = ti_txt.parse(INPUT_FILE_NAME)<br>
</pre>

where:<br>
<ul><li>content is the output TI-TXT file content in Pyhton dictionary output structure (can be empty dictionary {} if parsing fails)<br>
</li><li>INPUT_FILE_NAME is the input TI-TXT file name</li></ul>

<h3>fill</h3>
fill empty memory of the TI-TXT file content generated by parse method throughout the given memory range given by start and end addresses parameter.<br>
<br>
<pre>
>>> new_content = ti_txt.fill(content, START_ADDR, END_ADDR, FILL_BYTE)<br>
</pre>

where:<br>
<ul><li>new_content is the output TI-TXT file content in Python dictionary with filled empty memory<br>
</li><li>content is the input TI-TXT file content in Pyhton dictionary structure generated from parse method<br>
</li><li>START_ADDR is the input start address of the memory range<br>
</li><li>END_ADDR is the input end address of the memory range<br>
</li><li>FILL_BYTE is the input byte to be filled in the empty memory in the memory range</li></ul>

<h3>join</h3>
join two TI-TXT file contents in Python dictionary structure. Fail if there is overlapped memory range between two contents.<br>
<br>
<pre>
>>> join_content = ti_txt.join(content1, content2)<br>
</pre>

where:<br>
<ul><li>join_content is the output TI-TXT file content in Python dictionary<br>
</li><li>content1 is the input of first TI-TXT file content in Pyhton dictionary structure<br>
</li><li>content2 is the input of second TI-TXT file content in Pyhton dictionary structure</li></ul>

<h3>print_ti_txt</h3>
print out an input TI-TXT file content into a given output file name.<br>
<br>
<pre>
>>> ti_txt.print_ti_txt(OUT_FILE_NAME, content)<br>
</pre>

where:<br>
<ul><li>OUT_FILE_NAME is the output of TI-TXT file<br>
</li><li>content is the input TI-TXT file content in Pyhton dictionary structure</li></ul>

<br>

<h2>Advanced TI-TXT-Parser Features</h2>

The current implementation of TI-TXT-Parser supports the following advanced features:<br>
<br>
<h3>Combining Two TI-TXT Files</h3>
The TI-TXT-Parser can be used to combine two TI-TXT files by using the -f (for the name of the first input file) and  -j (for the name of the second input file). The TI-TXT parser will fail if there is an overlapped memory area between the two input files.<br>
<br>
<br>
<h3>Filling Vacant Memory Address</h3>
The TI-TXT-Parser can be used to generate a new TI-TXT file from and input file (given by -f parameter), with the vacant memory address filled by a given input. Use -s and -e to determine the address range, and per default the vacant memory address is filled with 0xFF (can be changed by giving another value for the 4th parameter when calling the fill() function of TI-TXT-Parser object).<br>
<br>
<br>
<h3>MSP430G2xx vBSL Host</h3>
The TI-TXT-Parser package contains an example script called MSP430G2xxBslHost.py which can be used for the host software of the MSP430G2xx vBSL Host. For more information, please refer <a href='http://processors.wiki.ti.com/index.php/MSP430_-_G2xx_BSL'>here</a>.<br>
<br>
<br>
<h3>Checksum Calculation</h3>
The TI-TXT-Parser can be also used to parse a TI-TXT file and then calculate the expected memory checksum.<br>
<br>
<br>
<h3>Generating Multiple TI-TXT with Unique ID</h3>
The TI-TXT-Parser can be also used to parse a TI-TXT file then generate multiple TI-TXT files and adding a unique ID for each output files.<br>
<br>
<br>
<h3>OpenBSL Host</h3>
The TI-TXT-Parser example also implements additional script which can act as the OpenBSL host to program the MSP430G2553 on MSP-EXP430G2 Launchpad development kit.<br>
<br>
